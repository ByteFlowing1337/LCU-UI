name: CI

on:
  push:
    branches: [main, dev]
  pull_request:
    branches: [main, dev]

jobs:
  lint-and-test:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout
        uses: actions/checkout@v4

      - name: Set up Python
        uses: actions/setup-python@v5
        with:
          python-version: "3.10"

      - name: Install uv
        run: pip install uv

      - name: Sync dependencies
        run: uv sync --locked

      - name: Lint with ruff
        run: uv run ruff check src --output-format=github
        continue-on-error: true

      - name: Check imports
        run: |
          uv run python -c "
          import sys
          sys.path.insert(0, 'src')

          # Test core imports
          from config import app_state
          from constants import get_champion_map
          from core import lcu
          from routes import page_bp, data_bp
          from services import auto_accept, auto_analyze, auto_banpick
          from websocket import register_socket_events
          from utils import get_local_ip

          print('✅ All imports successful')
          "

      - name: Smoke test - Flask app creation
        run: |
          uv run python -c "
          import sys
          sys.path.insert(0, 'src')
          from app import create_app
          app, socketio = create_app()
          print('✅ Flask app created successfully')
          print(f'   Registered blueprints: {[bp.name for bp in app.blueprints.values()]}')
          "
